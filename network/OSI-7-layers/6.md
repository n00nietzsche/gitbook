# 6. OSI 7계층 전체적인 흐름 정리

## 역할 정리

![](https://images.velog.io/images/jakeseo_me/post/047d26f5-6f2f-46c9-85c6-7ebdfe432459/image.png)

## 일반적인 흐름

![](https://images.velog.io/images/jakeseo_me/post/3dcb96e7-c054-47ba-8c02-aba6f915e81b/image.png)

## 일반적인 인터넷(HTTP) 통신 예제

![](https://images.velog.io/images/jakeseo_me/post/3f5c2e6b-951f-45d8-b2c2-0de9752eb50a/image.png)

위는 클라이언트 송신 기준이며, 서버 기준에서는 순서가 반대로 이루어진다고 생각하면 된다.

![](https://images.velog.io/images/jakeseo_me/post/2dead1ab-155c-4a38-9153-da611749efe9/image.png)

서버의 경우 클라이언트에서 받은 정보들이 하나씩 분리되어 사라지며, 마지막에 HTTP 메세지만 받게 된다.

### 장치로 살펴보기

![](https://images.velog.io/images/jakeseo_me/post/20ebfa59-f5ee-4e34-a140-3788fe1385ef/image.png)

위와 같은 장치를 따라 클라이언트에서 서버로 전해지며 각 장치를 이동할 때는 당연히 물리계층을 다시 거쳐 전선으로 전해질 수 있는 전기신호를 만들어내야 한다.

각 장치에서는 캡슐화 및 역캡슐화를 통해 필요한 부분을 붙이거나 필요한 부분을 확인한다. 

이를테면 스위치의 케이블을 통해 라우터로 데이터가 전송된 이후, 위 그림에서 `L3 라우터 A`는 **데이터링크 계층에서 이더넷 프레임의 목적지 MAC 주소와 자신의 목적지 MAC 주소를 확인**하게 된다. 이 때 주소가 같으면, 이더넷 헤더와 트레일러를 분리하는 역캡슐화를 수행한다.

이더넷 헤더와 트레일러를 분리하는 역캡슐화 작업이 완료되면 역캡슐화된 데이터를 **네트워크 계층**으로 송신한다. 역캡슐화 된 상태에서는 IP 패킷에 접근 가능하다. 그래서 **네트워크 계층에서는 라우팅 테이블과 IP 패킷의 목적지 IP주소를 비교하여 올바른 목적지인지 확인한다.** 목적지 확인 후 올바른 목적지라면, 다시 캡슐화를 거쳐 이더넷 프레임을 다시 붙여서 전기신호로 만든 뒤에 다음 라우터인 `L3 라우터 B`로 신호를 넘긴다.

이 과정에서 `L3라우터 A`와 `L3 라우터 B`는 다른 네트워크 상에 존재하므로, 출발지 IP를 `L3 라우터 내부 IP 주소`에서 `L3 라우터의 네트워크 외부 IP 주소`로 설정한다. 

### 장비별 계층 사용 영역

![](https://images.velog.io/images/jakeseo_me/post/aff0b331-3119-47f3-bd15-4afb25f11945/image.png)

장치의 사용 영역은 위와 같다. 스위치와 라우터라는 중개 장비를 통하여 컴퓨터와 서버에게 알맞은 네트워크 신호가 넘어오게 된다.

각 장비들은 전선을 통해 다른 장비에게 신호를 보내기 위해 물리계층부터 해당 장비가 포함하는 최상위 계층까지 갔다가, 다시 물리 계층으로 돌아와 전기 신호를 만들어 전선으로 다른 장비에게 신호를 보내는 과정을 거쳐야 한다.

## 정적 라우팅과 동적 라우팅

- 정적 라우팅은 라우팅 테이블에 목적지 경로를 수동으로 추가하는 방법이다.
  - 목적지 경로를 고정하거나 경로가 한정되는 경우에 사용한다.
  - 모든 목적지 네트워크 정보를 라우터에 기입해야 하며, 관리자의 관리 포인트가 늘어 번거롭다.
  - 소규모 네트워크에서 사용한다.
  - 대역폭 부담이 적다.
  - 보안 유지에 용이하다.
  - 경로 장애 발생 시 경로 우회가 불가능하다.
- 동적 라우팅은 자동으로 라우팅 테이블을 업데이트하는 방법이다.
  - 대규모 라우팅에 적합하다.
